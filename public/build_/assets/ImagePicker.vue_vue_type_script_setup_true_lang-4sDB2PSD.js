import{M as C,d as G,p as M,r as c,L as te,z as ae,I as le,c as f,f as B,o as m,b as e,g as U,i as K,N as oe,F as N,j as S,t as $,B as E,A as T,a as se,e as L}from"./app-B_Zw6QGP.js";const F="/fm",j={async list(i={}){const{data:n}=await C.get(`${F}/list`,{params:i});return n},async upload(i,n){const l=new FormData;i.forEach(v=>l.append("file[]",v));const{data:b}=await C.post(`${F}/upload`,l,{params:{directory:n}});return b},async createFolder(i,n){const{data:l}=await C.post(`${F}/folder`,{folder:i},{params:{directory:n}});return l},async delete(i){const n=new URLSearchParams;i.forEach(b=>n.append("path[]",b));const{data:l}=await C.post(`${F}/delete`,n);return l}},re={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},ne={class:"relative z-10 w-full max-w-5xl bg-white rounded shadow-lg"},de={class:"p-4 space-y-3"},ie={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},ue={class:"flex items-center gap-2"},ce=["disabled"],pe=["disabled"],be=["value"],ve={class:"flex items-stretch gap-2"},fe={key:0,class:"flex items-stretch gap-2"},me={class:"grid grid-cols-1 sm:grid-cols-3 lg:grid-cols-4 gap-4"},he={class:"flex items-center justify-center h-36"},ge=["onClick"],ye={class:"flex items-center gap-2"},xe=["value"],_e=["title"],we={class:"flex items-center justify-center h-36"},ke=["href","onClick"],Ve=["src","alt"],Ce={class:"flex items-center gap-2"},Ue=["value"],$e=["title"],Fe={key:1,class:"flex items-center justify-end gap-2 pt-2 border-t"},je=["disabled"],Me=["disabled"],R=12,Pe=G({__name:"FileManagerModal",props:{modelValue:{type:Boolean},startDirectory:{},maxUploadKB:{}},emits:["update:modelValue","picked"],setup(i,{emit:n}){const l=i,b=n,v=M({get:()=>l.modelValue,set:t=>b("update:modelValue",t)}),s=c(l.startDirectory||""),x=c(""),d=c(1),w=c([]),p=c([]),r=te({total:0,page:1,limit:R}),u=c([]),k=c(!1),_=c(""),P=M(()=>Math.max(1,Math.ceil(r.total/r.limit))),O=M(()=>s.value.includes("/"));async function h(){const t=await j.list({directory:s.value,filter_name:x.value,page:d.value,limit:R});w.value=t.directories,p.value=t.images,r.total=t.pagination.total,r.page=t.pagination.page,u.value=[]}function V(){h()}function z(){d.value=1,h()}function A(t){d.value=t,h()}function W(t){s.value=ee(s.value,t.name),d.value=1,h()}function q(){if(!s.value)return;const t=s.value.lastIndexOf("/");s.value=t>-1?s.value.slice(0,t):"",d.value=1,h()}function H(){k.value=!k.value}async function J(){if(!_.value)return;const t=await j.createFolder(_.value,s.value);t.error?alert(t.error):(_.value="",k.value=!1,V())}const I=c(null);function Q(){I.value?.click()}async function X(t){const a=t.target;if(!a.files||a.files.length===0)return;const o=l.maxUploadKB||1024*4;for(const g of Array.from(a.files))if(g.size/1024>o){alert("File exceeds max size"),a.value="";return}const y=await j.upload(Array.from(a.files),s.value);y.error?alert(y.error):(alert("Uploaded"),V()),a.value=""}async function Y(){if(u.value.length===0||!confirm("Are you sure?"))return;const t=await j.delete(u.value);t.error?alert(t.error):(alert("Deleted"),V())}function Z(t){b("picked",{path:t.path,href:t.href,name:t.name,thumb:t.thumb}),D()}function D(){v.value=!1}function ee(t,a){return[t,a].filter(Boolean).join("/")}return ae(()=>l.modelValue,t=>{t&&h()}),le(()=>{v.value&&h()}),(t,a)=>v.value?(m(),f("div",re,[e("div",{class:"absolute inset-0 bg-black/50",onClick:D}),e("div",ne,[e("div",{class:"flex items-center justify-between px-4 py-3 border-b"},[a[6]||(a[6]=e("h3",{class:"text-lg font-semibold"},"File Manager",-1)),e("button",{class:"p-2",onClick:D},"âœ•")]),e("div",de,[e("div",ie,[e("div",ue,[e("button",{class:"px-3 py-2 text-sm bg-gray-100 rounded border border-gray-200 hover:bg-gray-200 disabled:opacity-50",onClick:q,disabled:!O.value},"Parent",8,ce),e("button",{class:"px-3 py-2 text-sm bg-gray-100 rounded border border-gray-200 hover:bg-gray-200 disabled:opacity-50",onClick:V},"Refresh"),e("button",{class:"px-3 py-2 text-sm rounded border border-transparent bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",onClick:Q},"Upload"),e("button",{class:"px-3 py-2 text-sm bg-gray-100 rounded border border-gray-200 hover:bg-gray-200 disabled:opacity-50",onClick:H},"Folder"),e("button",{class:"px-3 py-2 text-sm rounded border border-transparent bg-red-600 text-white hover:bg-red-700 disabled:opacity-50",onClick:Y,disabled:u.value.length===0},"Delete",8,pe),e("input",{type:"hidden",value:s.value},null,8,be)]),e("div",ve,[U(e("input",{"onUpdate:modelValue":a[0]||(a[0]=o=>x.value=o),type:"text",placeholder:"Search",class:"px-3 py-2 border border-gray-300 rounded w-64",onKeydown:oe(z,["enter"])},null,544),[[K,x.value]]),e("button",{class:"px-3 py-2 text-sm rounded border border-transparent bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",onClick:z},"Search")])]),k.value?(m(),f("div",fe,[U(e("input",{"onUpdate:modelValue":a[1]||(a[1]=o=>_.value=o),type:"text",placeholder:"Folder name",class:"px-3 py-2 border border-gray-300 rounded"},null,512),[[K,_.value]]),e("button",{class:"px-3 py-2 text-sm rounded border border-transparent bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",onClick:J},"Create")])):B("",!0),a[7]||(a[7]=e("hr",null,null,-1)),e("div",me,[(m(!0),f(N,null,S(w.value,(o,y)=>(m(),f("div",{key:"d-"+y,class:"space-y-2"},[e("div",he,[e("a",{href:"#",onClick:E(g=>W(o),["prevent"]),class:"text-6xl"},"ðŸ“",8,ge)]),e("label",ye,[U(e("input",{type:"checkbox",class:"w-4 h-4",value:o.path+"/","onUpdate:modelValue":a[2]||(a[2]=g=>u.value=g)},null,8,xe),[[T,u.value]]),e("span",{class:"truncate",title:o.name},$(o.name),9,_e)])]))),128)),(m(!0),f(N,null,S(p.value,(o,y)=>(m(),f("div",{key:"f-"+y,class:"space-y-2"},[e("div",we,[e("a",{href:o.href,onClick:E(g=>Z(o),["prevent"]),class:"block"},[e("img",{src:o.thumb||o.href,alt:o.name,class:"max-h-36 object-contain"},null,8,Ve)],8,ke)]),e("label",Ce,[U(e("input",{type:"checkbox",class:"w-4 h-4",value:o.path,"onUpdate:modelValue":a[3]||(a[3]=g=>u.value=g)},null,8,Ue),[[T,u.value]]),e("span",{class:"truncate",title:o.name},$(o.name),9,$e)])]))),128))]),P.value>1?(m(),f("div",Fe,[e("button",{class:"px-3 py-2 text-sm bg-gray-100 rounded border border-gray-200 hover:bg-gray-200 disabled:opacity-50",disabled:d.value===1,onClick:a[4]||(a[4]=o=>A(d.value-1))},"Prev",8,je),e("span",null,"Page "+$(d.value)+" / "+$(P.value),1),e("button",{class:"px-3 py-2 text-sm bg-gray-100 rounded border border-gray-200 hover:bg-gray-200 disabled:opacity-50",disabled:d.value===P.value,onClick:a[5]||(a[5]=o=>A(d.value+1))},"Next",8,Me)])):B("",!0)]),e("input",{ref_key:"uploadInput",ref:I,type:"file",multiple:"",class:"hidden",onChange:X},null,544)])])):B("",!0)}}),De={class:"max-w-xs border rounded overflow-hidden"},Be=["src"],Ne={class:"grid grid-cols-2"},ze=["name","value"],Ie=G({__name:"ImagePicker",props:{name:{},modelValue:{},placeholder:{},baseUrl:{},thumb:{}},emits:["update:modelValue"],setup(i,{emit:n}){const l=i,b=n,v=c(!1),s=c(l.thumb??void 0),x=M(()=>{if(s.value)return s.value;if(l.thumb)return l.thumb;if(l.modelValue){if(l.modelValue.startsWith("http"))return l.modelValue;if(l.baseUrl)return l.baseUrl.replace(/\/$/,"")+"/"+l.modelValue.replace(/^\//,"")}return l.placeholder||"/storage/placeholder.png"});function d(p){console.log("p",p),s.value=p.thumb??void 0,b("update:modelValue",l.baseUrl?p.path:p.href)}function w(){s.value="/storage/placeholder.png",b("update:modelValue",void 0)}return(p,r)=>(m(),f(N,null,[e("div",De,[e("img",{src:x.value,alt:"",class:"w-full object-contain"},null,8,Be),e("div",Ne,[e("button",{type:"button",class:"px-3 py-2 text-sm rounded-none border border-transparent bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",onClick:r[0]||(r[0]=u=>v.value=!0)},[...r[2]||(r[2]=[e("i",{class:"fa-solid fa-pencil"},null,-1),L(" Edit ",-1)])]),e("button",{type:"button",class:"px-3 py-2 text-sm rounded-none border border-transparent bg-yellow-500 text-white hover:bg-yellow-600 disabled:opacity-50",onClick:w},[...r[3]||(r[3]=[e("i",{class:"fa-regular fa-trash-can"},null,-1),L(" Clear ",-1)])])]),e("input",{type:"hidden",name:p.name,value:p.modelValue},null,8,ze)]),se(Pe,{modelValue:v.value,"onUpdate:modelValue":r[1]||(r[1]=u=>v.value=u),onPicked:d},null,8,["modelValue"])],64))}});export{Ie as _};
