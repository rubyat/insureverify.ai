import{d as V,r as d,c as m,o as p,a as b,u as C,h as D,w as E,b as t,t as f,g as n,i as r,f as A,F as N,m as S}from"./app-B_Zw6QGP.js";import{_ as U}from"./AppLayout.vue_vue_type_script_setup_true_lang-oEio1Vio.js";import"./index-7eilHQPG.js";import"./useForwardExpose-C6-hPyV1.js";import"./VisuallyHidden-Cy1sULpD.js";import"./createLucideIcon-CHfYH6pV.js";const q={class:"mx-auto max-w-2xl px-6 py-12"},F={class:"text-2xl font-semibold"},z={class:"mt-2 text-muted-foreground"},B={class:"mt-8 space-y-4"},L={class:"grid gap-4 sm:grid-cols-2"},P={class:"sm:col-span-2"},j={class:"mt-6 flex items-center gap-4"},I=["disabled"],K={key:0},T={key:1},$={key:0,class:"text-red-600 text-sm"},R=V({__name:"Subscription",props:{plan:{},anet:{}},setup(y){const u=y,l=d({card_number:"",expiry_month:"",expiry_year:"",cvv:"",first_name:"",last_name:""}),c=d(null),o=d(!1),i=d(null),_=async()=>{typeof window>"u"||window.Accept||await new Promise((s,e)=>{const a=document.createElement("script");a.src="https://js.authorize.net/v1/Accept.js",a.async=!0,a.onload=()=>s(),a.onerror=()=>e(new Error("Failed to load Authorize.Net script")),document.head.appendChild(a)})},w=async()=>(await _(),new Promise((s,e)=>{const a={clientKey:u.anet.clientKey,apiLoginID:u.anet.loginId},k={cardNumber:l.value.card_number,month:l.value.expiry_month,year:l.value.expiry_year,cardCode:l.value.cvv},h={authData:a,cardData:k};Accept.dispatchData(h,v=>{if(v.messages.resultCode==="Error"){e(new Error(v.messages.message[0].text));return}const x=v.opaqueData;c.value={descriptor:x.dataDescriptor,value:x.dataValue},s()})})),g=async()=>{o.value=!0,i.value=null;try{await w()}catch(s){i.value=s?.message||"Tokenization failed",o.value=!1;return}await S.post(route("subscription.store"),{plan_id:u.plan.id,opaque_descriptor:c.value?.descriptor,opaque_value:c.value?.value,first_name:l.value.first_name,last_name:l.value.last_name},{onError:s=>{i.value="Validation failed",o.value=!1},onSuccess:()=>o.value=!1})};return(s,e)=>(p(),m(N,null,[b(C(D),{title:"Subscribe"}),b(U,null,{default:E(()=>[t("div",q,[t("h1",F,"Subscribe to "+f(u.plan.name),1),t("p",z,"Amount: $"+f(Number(u.plan.price).toFixed(2))+" / month",1),t("div",B,[t("div",L,[t("div",P,[e[6]||(e[6]=t("label",{class:"block text-sm font-medium"},"Card number",-1)),n(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.card_number=a),type:"text",class:"mt-1 w-full rounded border p-2",placeholder:"4111111111111111"},null,512),[[r,l.value.card_number]])]),t("div",null,[e[7]||(e[7]=t("label",{class:"block text-sm font-medium"},"Expiry month",-1)),n(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.expiry_month=a),type:"text",class:"mt-1 w-full rounded border p-2",placeholder:"12"},null,512),[[r,l.value.expiry_month]])]),t("div",null,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium"},"Expiry year",-1)),n(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.expiry_year=a),type:"text",class:"mt-1 w-full rounded border p-2",placeholder:"2030"},null,512),[[r,l.value.expiry_year]])]),t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium"},"CVV",-1)),n(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.cvv=a),type:"text",class:"mt-1 w-full rounded border p-2",placeholder:"123"},null,512),[[r,l.value.cvv]])]),t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium"},"First name",-1)),n(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.first_name=a),type:"text",class:"mt-1 w-full rounded border p-2"},null,512),[[r,l.value.first_name]])]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium"},"Last name",-1)),n(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.last_name=a),type:"text",class:"mt-1 w-full rounded border p-2"},null,512),[[r,l.value.last_name]])])])]),t("div",j,[t("button",{disabled:o.value,onClick:g,class:"inline-flex items-center rounded-md bg-primary px-4 py-2 text-white"},[o.value?(p(),m("span",K,"Processing...")):(p(),m("span",T,"Confirm and Subscribe"))],8,I),i.value?(p(),m("span",$,f(i.value),1)):A("",!0)])])]),_:1})],64))}});export{R as default};
